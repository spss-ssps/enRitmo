<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>contigo</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 0;
            background-color: #000000;
            font-family: 'DM Mono', monospace;
            font-size: 1.2em;
            color: #ffffff;
            text-decoration: none;
            overflow: hidden;
            cursor: url('src/peine.png') 10 10, auto;
        }

        .feedback-text {
            position: fixed;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            font-size: 0.8em;
        }

        .too-fast {
            color: #ff4444;
        }

        .too-slow {
            color: #4444ff;
        }

        .perfect {
            color: #44ff44;
        }

        .perfect a {
            color: #44ff44;
            text-decoration: underline;
        }

        .clickable {
            pointer-events: auto !important;
        }

        .instruction {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            opacity: 0.7;
            font-size: 1em;
        }
    </style>
</head>

<body>
    <!-- <div class="instruction">move your mouse up and down in rhythm</div> -->

    <!-- text -->
    <div class="feedback-text too-fast" id="fast1" style="top: 15%; left: 20%;">ow!! me duele, no puedes ir más lento?
    </div>

    <div class="feedback-text too-fast" id="fast2" style="top: 70%; left: 80%;">rushing</div>

    <div class="feedback-text too-fast" id="fast3" style="top: 40%; left: 10%;">slow down</div>

    <div class="feedback-text too-slow" id="slow1" style="top: 25%; left: 70%;">too slow</div>

    <div class="feedback-text too-slow" id="slow2" style="top: 80%; left: 30%;">wake up</div>

    <div class="feedback-text too-slow" id="slow3" style="top: 60%; left: 90%;">ow!! me duele, no puedes ir más rápido?
    </div>

    <div class="feedback-text perfect" id="perfect1" style="top: 35%; left: 50%;">
        asi está bien...
    </div>

    <div class="feedback-text perfect" id="perfect2" style="top: 55%; left: 25%; font-style: italic; color: #fff;">
        ya casi
    </div>

    <div class="feedback-text perfect" id="perfect3" style="top: 45%; left: 70%; font-style: italic; color: #fff;">
        <a href="galeria.html">ya esta!</a>
    </div>

    <script>
        let mousePositions = [];
        let lastTime = 0;
        let rhythmScore = 0;
        let perfectStage = 0; // 0: initial, 1: "asi está bien", 2: "ya casi", 3: "ya esta!" (final)
        let stageTimer = 0;
        let isCompleted = false;

        const targetInterval = 800; // target rhythm
        const tolerance = 400; // allowed deviation
        const stageTime = 2000; // Time to maintain rhythm for each stage (2 seconds)

        let currentFeedback = null;
        let feedbackTimeout = null;

        function showFeedback(type) {
            // Don't show feedback if completed
            if (isCompleted) return;

            // Hide all feedback first
            document.querySelectorAll('.feedback-text').forEach(el => {
                el.style.opacity = '0';
            });

            // Show specific stage for perfect rhythm
            if (type === 'perfect') {
                let elementToShow;

                if (perfectStage === 1) {
                    elementToShow = document.getElementById('perfect1'); // "asi está bien..."
                } else if (perfectStage === 2) {
                    elementToShow = document.getElementById('perfect2'); // "ya casi"
                } else if (perfectStage === 3) {
                    elementToShow = document.getElementById('perfect3'); // "ya esta!" with link
                    isCompleted = true; // Stop all interactions
                }

                if (elementToShow) {
                    elementToShow.style.opacity = '1';
                    // Make the final link clickable
                    if (perfectStage === 3) {
                        elementToShow.classList.add('clickable');
                    }
                }
            } else {
                // Show random text for too-fast or too-slow
                const elements = document.querySelectorAll(`.${type}`);
                if (elements.length > 0) {
                    const randomElement = elements[Math.floor(Math.random() * elements.length)];
                    randomElement.style.opacity = '1';

                    // Clear previous timeout
                    if (feedbackTimeout) {
                        clearTimeout(feedbackTimeout);
                    }

                    // Hide after 2 seconds
                    feedbackTimeout = setTimeout(() => {
                        randomElement.style.opacity = '0';
                    }, 2000);
                }
            }
        }

        function detectRhythm(currentTime, direction) {
            if (isCompleted) return;

            if (lastTime === 0) {
                lastTime = currentTime;
                return;
            }

            const interval = currentTime - lastTime;
            lastTime = currentTime;

            // Only count significant direction changes
            if (interval < 100) return;

            if (interval < targetInterval - tolerance) {
                // Too fast - reset progress
                showFeedback('too-fast');
                rhythmScore = 0;
                perfectStage = 0;
                stageTimer = 0;
            } else if (interval > targetInterval + tolerance) {
                // Too slow - reset progress
                showFeedback('too-slow');
                rhythmScore = 0;
                perfectStage = 0;
                stageTimer = 0;
            } else {
                // Perfect rhythm
                rhythmScore += 1;

                // Start stage progression
                if (rhythmScore >= 3 && perfectStage === 0) {
                    perfectStage = 1;
                    stageTimer = currentTime;
                    showFeedback('perfect');
                } else if (perfectStage === 1 && currentTime - stageTimer >= stageTime) {
                    perfectStage = 2;
                    stageTimer = currentTime;
                    showFeedback('perfect');
                } else if (perfectStage === 2 && currentTime - stageTimer >= stageTime) {
                    perfectStage = 3;
                    showFeedback('perfect');
                }
            }
        }

        let lastY = 0;
        let lastDirection = 0; // 1 for up, -1 for down

        document.addEventListener('mousemove', (e) => {
            if (isCompleted) return;

            const currentY = e.clientY;
            const currentTime = Date.now();
            const direction = currentY > lastY ? 1 : -1;

            // Detect direction change (up/down rhythm)
            if (direction !== lastDirection && lastDirection !== 0) {
                detectRhythm(currentTime, direction);
            }

            lastY = currentY;
            lastDirection = direction;
        });

        // Hide instruction after a few seconds
        setTimeout(() => {
            const instruction = document.querySelector('.instruction');
            if (instruction) {
                instruction.style.opacity = '0';
            }
        }, 4000);
    </script>

</body>